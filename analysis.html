<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>CP Lipid Droplet AI – Analysis</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="app-shell">
      <!-- HEADER -->
      <header class="cp-header">
        <div class="cp-header-inner">
          <div class="brand-area">
            <div class="brand-logo">CP</div>
            <div class="brand-text">
              <div class="brand-title">CP PRIMA</div>
              <div class="brand-subtitle">
                Lipid Droplet AI – Hepatopancreas Wet Mount
              </div>
            </div>
          </div>

          <nav class="nav-tabs">
            <a href="index.html" class="nav-btn">Training</a>
            <a href="analysis.html" class="nav-btn active">
              <span class="dot"></span>
              Analysis
            </a>
          </nav>
        </div>
      </header>

      <!-- MAIN -->
      <main class="main-content">
        <div class="page-container">
          <section class="page-card">
            <div class="page-title-row">
              <div>
                <h1 class="page-title">Lipid Droplet Analysis</h1>
                <p class="page-subtitle">
                  Use the trained model (from your browser storage or an
                  imported database) to estimate lipid droplet percentage for
                  multiple hepatopancreas wet mount images in one batch.
                </p>
              </div>

              <div class="badge-strip">
                <div class="badge-pill">
                  <span class="info-label">Model status</span>
                  <span id="analysisModelStatus"
                    ><strong>Not trained</strong></span
                  >
                </div>
              </div>
            </div>

            <div class="info-panel">
              <span class="info-label">Important</span>
              <span
                >Please make sure you have already trained the model or imported
                a database on the <strong>Training</strong> page before running
                analysis.</span
              >
            </div>

            <!-- SECTION: BATCH IMAGE ANALYSIS -->
            <div class="section-block">
              <div class="section-title-row">
                <div class="section-index">1</div>
                <div class="section-title">Batch Image Analysis</div>
              </div>
              <p class="section-desc">
                Select one or more images. The tool will output the filename and
                predicted lipid droplet percentage for each image.
              </p>

              <div class="form-grid">
                <div class="file-input-group">
                  <div class="file-input-label">Select images to analyse</div>
                  <div class="input-row">
                    <label class="btn btn-outline" for="analysisImagesInput">
                      Choose files…
                    </label>
                    <span id="analysisFilesLabel" class="info-stat">
                      No file chosen
                    </span>
                    <input
                      type="file"
                      id="analysisImagesInput"
                      accept="image/*"
                      multiple
                    />
                  </div>
                  <small class="section-desc">
                    You can upload several images at once. They will be processed
                    using the current model.
                  </small>
                </div>

                <div style="display: flex; align-items: flex-end">
                  <button
                    id="runAnalysisButton"
                    type="button"
                    class="btn btn-primary"
                  >
                    Run analysis
                  </button>
                </div>
              </div>

              <!-- OUTPUT TABLE -->
              <div id="analysisResults" class="analysis-output" style="display:none;">
                <div class="analysis-header">
                  <div>Filename</div>
                  <div>Predicted lipid droplet (%)</div>
                </div>
                <!-- Rows will be injected here by JS -->
              </div>
            </div>
          </section>
        </div>
      </main>

      <!-- FOOTER -->
      <footer class="cp-footer">
        <div class="cp-footer-inner">
          © 2025 CP Prima – Experimental Tool for Shrimp Hepatopancreas Lipid
          Assessment
        </div>
      </footer>
    </div>

    <script src="model.js"></script>
    <script src="storage.js"></script>
    <script src="app.js"></script>
  </body>
</html>
