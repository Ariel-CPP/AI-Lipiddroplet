<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CP | Hepatopancreas Lipid Droplet – Training</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app-shell">
    <!-- Top navigation bar -->
    <header class="app-header">
      <div class="brand">
        <div class="brand-logo">CP</div>
        <div class="brand-text">
          <div class="brand-company">Central Proteina Prima</div>
          <div class="brand-app-name">Lipid Droplet AI – Hepatopancreas Wet Mount</div>
        </div>
      </div>

      <nav class="app-nav">
        <a href="training.html" class="nav-link nav-link-active">Training</a>
        <a href="analysis.html" class="nav-link">Analysis</a>
      </nav>
    </header>

    <main class="app-main">
      <!-- Page title -->
      <section class="page-header">
        <h1>Training Interface</h1>
        <p class="page-subtitle">
          Upload wet mount hepatopancreas images and assign known lipid droplet percentages. 
          The model will be updated in your browser and can be exported or imported as a JSON database 
          to share with other users.
        </p>

        <div class="kpi-row">
          <div class="kpi-card">
            <div class="kpi-label">Total trained images</div>
            <div class="kpi-value" id="total-trained">0</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">Model status</div>
            <div class="kpi-value kpi-value-muted" id="model-info">Not trained</div>
          </div>
        </div>
      </section>

      <!-- Training card -->
      <section class="card">
        <div class="card-header">
          <h2>1. Upload Training Images</h2>
          <p class="card-description">
            Select one or more images. For each image, provide the ground-truth lipid droplet percentage (0–100%) based on your histological assessment.
          </p>
        </div>

        <div class="card-body">
          <!-- file input -->
          <div class="form-group">
            <label class="form-label" for="training-images-input">Select training images</label>
            <div class="input-row">
              <input
                type="file"
                id="training-images-input"
                accept="image/*"
                multiple
                class="input-file"
              />
            </div>
            <p class="help-text">
              You can select multiple images at once. The tool will ask for the lipid droplet percentage for each image.
            </p>
          </div>

          <!-- list of selected images and percentage inputs (JS will populate) -->
          <div id="training-image-list" class="image-list">
            <!-- dynamically filled by app.js -->
          </div>

          <div class="card-actions">
            <button id="train-button" class="btn btn-primary">
              Train model on selected images
            </button>
          </div>

          <div class="status-bar" id="training-status">
            <!-- status messages from JS -->
          </div>
        </div>
      </section>

      <!-- Database card -->
      <section class="card">
        <div class="card-header">
          <h2>2. Model Database</h2>
          <p class="card-description">
            The model and its metadata are stored locally in your browser. 
            You can export the database as a JSON file and share it with other users, 
            who can then import it to obtain the same trained model.
          </p>
        </div>

        <div class="card-body card-body-split">
          <!-- Download -->
          <div class="card-column">
            <h3 class="card-subtitle">Download database</h3>
            <p class="card-description">
              Export the current neural model and statistics as a JSON file.
            </p>

            <button id="download-db-button" class="btn btn-outline">
              Download JSON database
            </button>
          </div>

          <!-- Upload -->
          <div class="card-column">
            <h3 class="card-subtitle">Upload database</h3>
            <p class="card-description">
              Import a database JSON file from another user to reuse the same trained model.
            </p>

            <div class="input-row">
              <label class="btn btn-secondary btn-inline">
                <span>Select JSON file</span>
                <input
                  type="file"
                  id="upload-db-input"
                  accept="application/json"
                  class="input-file-hidden"
                />
              </label>
              <span id="upload-db-filename" class="filename-label">No file selected</span>
            </div>

            <div class="status-bar status-bar-inline" id="db-status">
              <!-- database import status -->
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="app-footer">
      © 2025 CP Prima – Experimental Tool for Shrimp Hepatopancreas Lipid Assessment
    </footer>
  </div>

  <script src="model.js"></script>
  <script src="storage.js"></script>
  <script src="app.js"></script>
</body>
</html>
