<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CP Lipid Droplet AI – Training</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Top navigation / brand -->
  <header class="cp-header">
    <div class="cp-header-inner">
      <div class="brand-area">
        <div class="brand-logo-circle">CP</div>
        <div>
          <div class="brand-text-main">Lipid Droplet AI</div>
          <div class="brand-text-sub">
            Hepatopancreas Wet Mount Assistant
          </div>
        </div>
      </div>

      <nav class="nav-actions">
        <a href="index.html" class="nav-btn nav-btn-active">
          <span class="dot"></span>
          Training
        </a>
        <a href="analysis.html" class="nav-btn">
          <span class="dot"></span>
          Analysis
        </a>
      </nav>
    </div>
  </header>

  <main class="page-shell">
    <!-- Page header & stats -->
    <section class="page-header">
      <div class="page-kicker">Model Training</div>
      <h1 class="page-title">Training Interface</h1>
      <p class="page-subtitle">
        Upload hepatopancreas wet mount images and assign the known lipid droplet
        percentage for each image. The in-browser neural model will be updated
        and can later be exported or imported as a JSON database.
      </p>

      <div class="stats-strip">
        <div class="stat-card">
          <div class="stat-label">Total trained images</div>
          <div class="stat-value" id="totalTrainedImages">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Model status</div>
          <div class="status-pill" id="modelStatus">
            <span class="status-dot"></span>
            Not trained
          </div>
        </div>
      </div>
    </section>

    <!-- Section 1: Upload training images -->
    <section class="section-card">
      <h2 class="section-title">1. Upload Training Images</h2>
      <p class="section-caption">
        Select one or more wet mount images. For each image you will be asked to
        provide the ground-truth lipid droplet percentage (0–100%) based on
        your histological assessment.
      </p>

      <div class="field-group">
        <div class="field-label">Select training images</div>
        <!-- keep the same input id so app.js continues to work -->
        <label class="file-btn">
          <span class="file-btn-icon">+</span>
          <span>Choose image files</span>
          <input
            type="file"
            id="trainImagesInput"
            accept="image/*"
            multiple
          />
        </label>
        <span class="file-chosen" id="trainFilesLabel">No files selected</span>
        <p class="field-note">
          You can select multiple images. The tool will ask for the lipid
          droplet percentage for each image.
        </p>
      </div>

      <button id="trainButton" class="btn btn-primary">
        Train model on selected images
      </button>

      <p class="section-status" id="trainingStatus"></p>
    </section>

    <!-- Section 2: Model database import / export -->
    <section class="section-card">
      <h2 class="section-title">2. Model Database</h2>
      <p class="section-caption">
        The trained model and its statistics are stored locally in your browser.
        Export the database as a JSON file to back it up or share with other
        users, or import a JSON file that you received from another user.
      </p>

      <div class="form-grid-two">
        <!-- Download -->
        <div>
          <div class="field-label">Download database</div>
          <p class="field-note">
            Export the current neural model and metadata as a JSON file.
          </p>
          <button id="downloadDbButton" class="btn btn-secondary">
            Download JSON database
          </button>
        </div>

        <!-- Upload -->
        <div>
          <div class="field-label">Upload database</div>
          <p class="field-note">
            Import a JSON database from another user to reuse the same trained
            model on this device.
          </p>
          <label class="file-btn">
            <span class="file-btn-icon">↑</span>
            <span>Select JSON file</span>
            <input
              type="file"
              id="uploadDbInput"
              accept="application/json"
            />
          </label>
          <span class="file-chosen" id="uploadDbLabel">No file selected</span>
        </div>
      </div>
    </section>
  </main>

  <footer class="cp-footer">
    © 2025 CP Prima – Experimental Tool for Shrimp Hepatopancreas Lipid
    Assessment
  </footer>

  <!-- Scripts (unchanged tools) -->
  <script src="model.js"></script>
  <script src="storage.js"></script>
  <script src="app.js"></script>
</body>
</html>
